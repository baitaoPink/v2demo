import{_ as ke}from"./Tree-Dv6CU1T9.js";import{d as ae,bg as X,bh as Se,r as o,ad as z,o as te,c as Ce,O as De,U as Z,V as Me,b as Ne,f as l,w as s,W as Ue,h as u,B as v,g as k,t as S,$ as r,X as Ae,N as Le,a5 as xe,cD as Fe,cE as Re,Z as Te}from"./index-DgS_gExp.js";import{_ as ze}from"./modal-form.vue_vue_type_script_setup_true_lang-BuDR1X64.js";import{_ as Be}from"./search-header-DC9myRJJ.js";import{_ as Ke}from"./table-header-button-group.vue_vue_type_script_setup_true_lang-BqWHjY4C.js";import{a as Oe,g as Ve,e as Ee,f as J,h as Pe}from"./system-manage-B6ZWZ7jW.js";import{u as Ie,N as $e}from"./custom-table-M__G0njN.js";import{_ as Y}from"./Flex-NxzTnbAG.js";import{_ as je}from"./DataTable-R-3tvq3U.js";import"./multi-language-form.vue_vue_type_script_setup_true_lang-D4ifp7HF.js";import"./custom-upload-DUUdPJxM.js";import"./Grid-BNV0w0mr.js";import"./get-slot-Bk_rJcZu.js";import"./FormItem-BAqcrsPW.js";import"./Spin-Bu1_C0Z0.js";import"./DatePicker-yC2d8YmP.js";import"./TimePicker-BsIq1gq9.js";import"./Forward-BOBl18BE.js";import"./RadioGroup-C9MN4_Hy.js";import"./Space-CMuvGHTq.js";const qe=ae({__name:"custom-tree",props:X({treeData:{},checkable:{type:Boolean,default:!0},selectable:{type:Boolean,default:!1},keyField:{default:"key"}},{treeSelectArray:{default:[]},treeSelectArrayModifiers:{}}),emits:X(["onCheck"],["update:treeSelectArray"]),setup(y,{emit:i}){const M=Se(y,"treeSelectArray"),_=i,d=o([]),m=o([]),h=n=>{M.value=n,d.value=n,m.value=n};function f(n,b,g){_("onCheck",{keys:n,option:b,meta:g})}return z(M,n=>{n.length&&(d.value=n,m.value=n)},{immediate:!0}),(n,b)=>{const g=ke;return te(),Ce(g,{"block-line":"",cascade:"",checkable:n.checkable!==!1,selectable:n.selectable===!0,"show-line":"","key-field":n.keyField,"check-on-click":"",data:n.treeData,"default-checked-keys":m.value,"onUpdate:checkedKeys":h,"onUpdate:selectedKeys":f},null,8,["checkable","selectable","key-field","data","default-checked-keys"])}}});function ee(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!Te(y)}const ma=ae({name:"system-manage_role-manage",__name:"index",setup(y){const{pagination:i,renderCell:M}=Ie(),_=De(),d=o(0),m=o(!1),h=o(!1),f=o([]),n=o([]),b={},g=o([]),R=o([]),T=o([]),N=o(!1),B=o(!0),U=o(!1),A=o(!1),K=o(!0),L=o(!1),O=o([{type:"Input",valueName:"role_name",label:"名称"},{type:"Slot",valueName:"rules",label:"权限",slotName:"addAuth"},{type:"Input Number",valueName:"level",label:"等级"},{type:"Radio",valueName:"status",label:"状态",radioGroupOption:[{label:"开启",value:1},{label:"禁用",value:0}]}]),V={role_name:[{required:!0,message:"请输入角色管理名称",trigger:["blur"]}],rules:[{required:!0,message:"请选择角色权限",trigger:["blur"],validator:()=>d.value?n.value.length?!0:new Error("请选择角色权限"):f.value.length?!0:new Error("请选择角色权限")}]},E=o([]),C=o([]),le=o([{type:"Select",valueName:"status",label:"状态",defaultOption:[{value:"1",label:"启用"},{value:"0",label:"禁用"}]},{type:"Input",valueName:"role_name",placeholder:"请输入角色名称"}]),D=o([]),oe=o([]),ne=[{title:"ID",key:"id",align:"center"},{title:"角色名称",key:"role_name",align:"center"},{title:"等级",key:"level",align:"center"},{title:"创建时间",key:"create_time",align:"center"},{title:"状态",key:"status",align:"center",render:a=>l(Ae,{value:a.status,"onUpdate:value":e=>a.status=e,"checked-value":1,"unchecked-value":0,loading:a.statusLoading,"on-update:value":()=>ye(a)},null)},{title:"操作",key:"action",align:"center",width:300,fixed:"right",render:a=>{let e;return l(Y,{justify:"center"},{default:()=>[l(v,{type:"success",size:"small",onClick:ve.bind(null,a)},ee(e=r("common.modify"))?e:{default:()=>[e]}),l($e,{"onPositive-click":de.bind(null,a.id)},{default:()=>[r("common.confirmDelete")],trigger:()=>{let c;return l(v,{type:"error",size:"small"},ee(c=r("common.delete"))?c:{default:()=>[c]})}})]})}}],P=o([]),w=o(!1),I=o({});function se(a){I.value=a,i.page=1,p()}async function ue(){const{data:a}=await Oe();T.value=a.map(e=>$(e))}function $(a){const e={key:a.id,label:a.menu_name};return b[a.id]=a.menu_name,a.children&&(e.children=a.children.map(c=>$(c))),e}async function p(){w.value=!0;const{data:a}=await Ve({page:i.page,limit:i.pageSize,...I.value});P.value=a.list,i.itemCount=a.count,w.value=!1}function re(a){i.page=a,p()}function ie(a){i.page=1,i.pageSize=a,p()}async function de(a){w.value=!0;const{response:e}=await Ee(a);e.data.status===200&&(p(),_.success(r("common.deleteSuccess")))}function ce(a,e){D.value=a,oe.value=e}function me(){d.value=0,N.value=!0}async function fe(a){U.value=!0;const{response:e}=await J({rules:f.value,...a});e.data.status===200&&(p(),_.success(r("common.addSuccess")),N.value=!1),U.value=!1}function pe(){f.value=[]}function ve(a){d.value=a.id,C.value[0].defaultValue=a.role_name,n.value=a.rule_ids.split(",").map(Number),C.value[2].defaultValue=a.level,C.value[3].defaultValue=a.status,A.value=!0}async function ge(a){L.value=!0;const{response:e}=await J({id:d.value,rules:n.value,...a});e.data.status===200&&(p(),_.success(r("common.modifySuccess")),A.value=!1),L.value=!1}async function ye(a){a.statusLoading=!0;let e=0;a.status===0?e=1:e=0;const{response:c}=await Pe(a.id,e);c.data.status===200&&(a.status=e,_.success(r("common.modifySuccess"))),a.statusLoading=!1}function j(){d.value?h.value=!0:m.value=!0}function x(){d.value?h.value=!1:m.value=!1}return z(f,a=>{g.value=a.map(e=>b[e])}),z(n,a=>{R.value=a.map(e=>b[e])}),p(),ue(),E.value=Z(O.value),C.value=Z(O.value),(a,e)=>{const c=Ke,_e=Be,he=je,be=Le,q=xe,F=Y,G=ze,H=qe,Q=Fe,W=Re,we=Me("resize");return te(),Ne("div",null,[l(be,{title:"角色管理"},{"header-extra":s(()=>[l(c,{"refresh-button-loading":w.value,"onUpdate:refreshButtonLoading":e[0]||(e[0]=t=>w.value=t),"export-selected-disabled":D.value.length,"onUpdate:exportSelectedDisabled":e[1]||(e[1]=t=>D.value.length=t),"batch-delete-disabled":D.value.length,"onUpdate:batchDeleteDisabled":e[2]||(e[2]=t=>D.value.length=t),"is-export-all":!1,"is-export-filter":!1,"is-export-selected":!1,"is-batch-delete":!1,onAdd:me,onRefresh:p},null,8,["refresh-button-loading","export-selected-disabled","batch-delete-disabled"])]),default:s(()=>[l(_e,{"search-config":le.value,onOnSearch:se},null,8,["search-config"]),Ue(l(he,{remote:"","flex-height":"",columns:ne,data:P.value,loading:w.value,bordered:!1,height:620,"scroll-x":1e3,pagination:u(i),"row-key":t=>t.id,"render-cell":u(M),"onUpdate:checkedRowKeys":ce,"onUpdate:page":re,"onUpdate:pageSize":ie},null,8,["data","loading","pagination","row-key","render-cell"]),[[we]])]),_:1}),l(G,{"show-form-modal":N.value,"onUpdate:showFormModal":e[4]||(e[4]=t=>N.value=t),"is-async-shut-down":B.value,"onUpdate:isAsyncShutDown":e[5]||(e[5]=t=>B.value=t),"is-show-modal-loading":U.value,"onUpdate:isShowModalLoading":e[6]||(e[6]=t=>U.value=t),"modal-title":u(r)("common.add"),"modal-form-config":E.value,"form-rules":V,onOnSubmit:fe,onOnClose:pe},{addAuth:s(()=>[l(F,{wrap:!1},{default:s(()=>[l(q,{value:g.value,"onUpdate:value":e[3]||(e[3]=t=>g.value=t),filterable:"",multiple:"",tag:"",disabled:"",placeholder:"请选择权限","show-arrow":!1,show:!1},null,8,["value"]),l(u(v),{type:"primary",onClick:j},{default:s(()=>[k(S(u(r)("common.edit")),1)]),_:1})]),_:1})]),_:1},8,["show-form-modal","is-async-shut-down","is-show-modal-loading","modal-title","modal-form-config"]),l(G,{"show-form-modal":A.value,"onUpdate:showFormModal":e[8]||(e[8]=t=>A.value=t),"is-async-shut-down":K.value,"onUpdate:isAsyncShutDown":e[9]||(e[9]=t=>K.value=t),"is-show-modal-loading":L.value,"onUpdate:isShowModalLoading":e[10]||(e[10]=t=>L.value=t),"modal-title":u(r)("common.modify"),"modal-form-config":C.value,"form-rules":V,onOnSubmit:ge},{addAuth:s(()=>[l(F,{wrap:!1},{default:s(()=>[l(q,{value:R.value,"onUpdate:value":e[7]||(e[7]=t=>R.value=t),filterable:"",multiple:"",tag:"",disabled:"",placeholder:"请选择权限","show-arrow":!1,show:!1},null,8,["value"]),l(u(v),{type:"primary",onClick:j},{default:s(()=>[k(S(u(r)("common.edit")),1)]),_:1})]),_:1})]),_:1},8,["show-form-modal","is-async-shut-down","is-show-modal-loading","modal-title","modal-form-config"]),l(W,{show:m.value,"onUpdate:show":e[12]||(e[12]=t=>m.value=t),"default-width":502,placement:"right",resizable:""},{default:s(()=>[l(Q,{title:"新增权限"},{footer:s(()=>[l(F,null,{default:s(()=>[l(u(v),{onClick:x},{default:s(()=>[k(S(u(r)("common.close")),1)]),_:1}),l(u(v),{type:"primary",onClick:x},{default:s(()=>[k(S(u(r)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[l(H,{"tree-select-array":f.value,"onUpdate:treeSelectArray":e[11]||(e[11]=t=>f.value=t),"tree-data":T.value},null,8,["tree-select-array","tree-data"])]),_:1})]),_:1},8,["show"]),l(W,{show:h.value,"onUpdate:show":e[14]||(e[14]=t=>h.value=t),"default-width":502,placement:"right",resizable:""},{default:s(()=>[l(Q,{title:"编辑权限"},{footer:s(()=>[l(F,null,{default:s(()=>[l(u(v),{onClick:x},{default:s(()=>[k(S(u(r)("common.close")),1)]),_:1}),l(u(v),{type:"primary",onClick:x},{default:s(()=>[k(S(u(r)("common.confirm")),1)]),_:1})]),_:1})]),default:s(()=>[l(H,{"tree-select-array":n.value,"onUpdate:treeSelectArray":e[13]||(e[13]=t=>n.value=t),"tree-data":T.value},null,8,["tree-select-array","tree-data"])]),_:1})]),_:1},8,["show"])])}}});export{ma as default};
