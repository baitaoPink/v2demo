import{_ as be}from"./modal-form.vue_vue_type_script_setup_true_lang-Cjcae1c8.js";import{_ as he}from"./search-header-Y2BEBubG.js";import{_ as we}from"./table-header-button-group.vue_vue_type_script_setup_true_lang-CHhYnPru.js";import{d as _e,O as xe,r as n,U as G,V as Se,o as ke,b as Me,f as o,w as O,h as i,a1 as I,W as De,$ as u,X as Ce,B as K,a2 as Ne,N as Ue,Z as Pe}from"./index-B8uXi1CT.js";import{g as Q,a as Ae,b as Le,c as Ee,m as Fe,d as ze,e as Oe,f as Ie}from"./user-manage-CxnzfWEu.js";import{u as W,N as Te}from"./custom-table-CIoqtwR0.js";import{u as je}from"./exportExcel-BsCKL_7l.js";import{_ as Be}from"./Flex-Dd7uI-X0.js";import{_ as $e}from"./DataTable-JXNMHbFE.js";import"./multi-language-form.vue_vue_type_script_setup_true_lang-BZrBw3Pt.js";import"./custom-upload-TU2i3RYC.js";import"./Grid-8XO9VEVU.js";import"./get-slot-Bk_rJcZu.js";import"./FormItem-BkyFAWg2.js";import"./Spin-CPPIHThd.js";import"./DatePicker-BJOmBFQz.js";import"./TimePicker-qmmZBHrw.js";import"./Forward-zlCbBpdq.js";import"./RadioGroup-CyWpGGc2.js";import"./Space-BomAnmEk.js";function X(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!Pe(h)}const T="代理列表.xlsx",ra=_e({name:"agency-management_agency-list",__name:"index",setup(h){const{pagination:d,renderCell:j}=W(),{pagination:g}=W(),w=xe(),{exportExcel:P,exportLoading:r}=je(),f=n(!1),_=n([]),A=n([]),m=n("1"),B=n({is_agent:m.value}),Z=n([{label:"全部",value:""},{label:"显示",value:"1"},{label:"隐藏",value:"0"}]),J=n([{type:"Input",valueName:"name",label:"用户名称",placeholder:"请输入用户名称"},{type:"Input",valueName:"account",label:"代理登陆账号",placeholder:"请输入代理登陆账号"},{type:"Select",valueName:"status",label:"状态",placeholder:"请选择状态",defaultOption:Z.value}]),v=n(0),x=n(!1),$=n(!0),S=n(!1),ee=n({}),k=n(!1),R=n(!0),M=n(!1),D=n(!1),L=n(!1),V=n(!0),ae=n([{type:"Slot",slotName:"levelList",valueName:""}]),q=n([{type:"Input",valueName:"account",label:"代理账号"},{type:"Input",valueName:"real_name",label:"真实姓名"},{type:"Input",valueName:"phone",label:"手机号"},{type:"Select",valueName:"uid",label:"关联用户"},{type:"Radio",valueName:"status",label:"状态",radioGroupOption:[{label:"开启",value:1},{value:0,label:"关闭"}]}]),y=n([]),C=n([]),E={account:[{required:!0,message:"请输入代理账号",trigger:["blur"]}],nickname:[{required:!0,message:"请选择代理登陆名称",trigger:["blur"]}],real_name:[{required:!0,message:"请输入真实姓名",trigger:["blur"]}],phone:[{required:!0,trigger:["blur"],validator:(a,e)=>e?!0:new Error("请输入手机号")}],uid:[{required:!0,type:"number",message:"请选择关联用户",trigger:["blur"]}],pwd:[{required:!0,type:"number",trigger:["blur"],validator:(a,e)=>e?e.length>18?new Error("密码长度不可超过8位"):e.length<6?new Error("密码长度不可小于6位"):!0:new Error("请输入密码")}]};async function s(){f.value=!0;const{data:a}=await Q({...B.value,is_agent:m.value,page:d.page,limit:d.pageSize});d.itemCount=a.count,_.value=a.list,f.value=!1}async function te(a){f.value=!0;const{response:e}=await ze(a,{id:a,is_agent:m.value});e.data.status===200&&(s(),w.success(u("common.deleteSuccess")))}async function le(a){v.value=a;const{data:e}=await Oe(a,{is_agent:m.value});ee.value=e,C.value.forEach(l=>{l.defaultValue=e[l.valueName],l.valueName==="uid"&&(l.defaultValue=e.uid)}),k.value=!0}async function ne(){const{data:a}=await Ae(),e=a.map(l=>({label:l.name,value:l.value}));y.value.forEach((l,c)=>{l.valueName==="uid"&&(y.value[c].defaultOption=e,C.value[c].defaultOption=e)})}ne();async function oe(a,e){if(!e)return!1;A.value=[],D.value=!0,L.value=!0;const{data:l}=await Ie({agent_uid:a,page:g.page,limit:g.pageSize});return D.value=!1,A.value=l.list,g.itemCount=l.count,!0}const N=[{type:"selection"},{title:"代理账号",key:"account",align:"center",width:"80"},{title:"代理姓名",key:"real_name",align:"center",width:"100"},{title:"下级代理人数",key:"proxy_number",align:"center",width:"80",render:a=>o("div",{style:{color:"#646cff",cursor:a.proxy_number?"pointer":"default"},onClick:oe.bind(null,a.uid,a.proxy_number)},[a.proxy_number||0])},{title:"状态",key:"status",align:"center",width:"80",render:a=>{const e=n(a.status===1);return o(Ce,{value:e.value,"onUpdate:value":[l=>e.value=l,l=>{a.status=l?1:0,v.value=a.uid,Y({...a,status:l})}]},null)}},{title:"用户名称/电话",key:"infos",align:"center",width:"100",render:a=>o("div",null,[o("p",null,[a.nickname||"暂无昵称"]),o("p",null,[a.phone||"-"])])},{title:"创建时间",key:"create_time",align:"center",width:"180"},{title:"操作",key:"action",align:"center",width:"100",fixed:"right",render:a=>{let e;return o(Be,{justify:"center"},{default:()=>[o(K,{type:"success",size:"small",onClick:le.bind(null,a.id)},X(e=u("common.modify"))?e:{default:()=>[e]}),o(Te,{"onPositive-click":te.bind(null,a.uid)},{default:()=>[u("common.confirmDelete")],trigger:()=>{let l;return o(K,{type:"error",size:"small"},X(l=u("common.delete"))?l:{default:()=>[l]})}})]})}}],se=[{title:"代理商手机号",key:"account",align:"center",width:"80"},{title:"下线手机号",key:"phone",align:"center",width:"90"},{title:"姓名",key:"real_name",align:"center",width:"80"},{title:"白名单",key:"type_name",align:"center",width:"80"},{title:"代理等级",key:"lv_name",align:"center"},{title:"邮箱",key:"email",align:"center",width:"90"},{title:"下线账户余额",key:"money_balance",align:"center"},{title:"邀请时间",key:"agent_time",align:"center",render:a=>a.agent_time?Ne(String(a.agent_time)).format("YYYY-MM-DD HH:mm:ss"):""}];async function ie(){const{data:a}=await Q({is_agent:m.value}),e=a.list.map(l=>({...l,infos:`
      用户名称:${l.nickname?l.nickname:"/"};
      电话:${l.phone?l.phone:"/"};`,status:l.status===1?"开启":"关闭"}));P({tableColumns:N,tableData:e??[],fileName:T})}const p=n([]),H=n([]);function re(a){B.value=a,d.page=1,s()}function ue(a,e){p.value=a,H.value=e}function de(){y.value.push({type:"Input",inputType:"password",valueName:"pwd",label:"密码"}),x.value=!0}async function me(){f.value=!0;const{response:a}=await Le({id:p.value.join(","),is_agent:m.value});a.data.status===200&&(s(),p.value=[],w.success(u("common.deleteSuccess")))}async function pe(a){S.value=!0;const e={};a.up_where&&Array.isArray(a.up_where)&&(e.up_where=a.up_where.join(","));const{response:l}=await Ee({...a,...e,status:a.status?1:0,is_agent:m.value});l.data.status===200&&(s(),w.success(u("common.addSuccess")),x.value=!1),S.value=!1}async function Y(a){a.id&&(v.value=a.id),M.value=!0;const e={};a.up_where&&Array.isArray(a.up_where)&&(e.up_where=a.up_where.join(","));const c={..._.value.find(F=>F.uid===v.value),...a,...e,id:v.value,status:a.status?1:0,is_agent:m.value};"pwd"in c&&delete c.pwd;const{response:U}=await Fe(v.value,{...c});U.data.status===200&&(s(),w.success(u("common.modifySuccess")),k.value=!1),M.value=!1}function ce(a){d.page=a,s()}function ge(a){d.page=1,d.pageSize=a,s()}function fe(a){g.page=a,s()}function ve(a){g.page=1,g.pageSize=a,s()}return s(),y.value=G(q.value),C.value=G(q.value),(a,e)=>{const l=we,c=he,U=$e,F=Ue,z=be,ye=Se("resize");return ke(),Me("div",null,[o(F,{title:"代理列表"},{"header-extra":O(()=>[o(l,{"export-all-loading":i(r),"onUpdate:exportAllLoading":e[0]||(e[0]=t=>I(r)?r.value=t:null),"refresh-button-loading":f.value,"onUpdate:refreshButtonLoading":e[1]||(e[1]=t=>f.value=t),"export-selected-disabled":p.value.length,"onUpdate:exportSelectedDisabled":e[2]||(e[2]=t=>p.value.length=t),"batch-delete-disabled":p.value.length,"onUpdate:batchDeleteDisabled":e[3]||(e[3]=t=>p.value.length=t),"export-filter-loading":i(r),"onUpdate:exportFilterLoading":e[4]||(e[4]=t=>I(r)?r.value=t:null),"export-selected-loading":i(r),"onUpdate:exportSelectedLoading":e[5]||(e[5]=t=>I(r)?r.value=t:null),onExportAll:ie,onExportFilter:e[6]||(e[6]=t=>{i(P)({tableColumns:N,tableData:_.value.map(b=>({...b,status:b.status===1?"开启":"关闭"})),fileName:T})}),onExportSelected:e[7]||(e[7]=t=>{i(P)({tableColumns:N,tableData:H.value.map(b=>({...b,status:b.status===1?"开启":"关闭"})),fileName:T})}),onAdd:de,onBatchDelete:me,onRefresh:s},null,8,["export-all-loading","refresh-button-loading","export-selected-disabled","batch-delete-disabled","export-filter-loading","export-selected-loading"])]),default:O(()=>[o(c,{"search-config":J.value,onOnSearch:re},null,8,["search-config"]),De(o(U,{remote:"",columns:N,data:_.value,loading:f.value,bordered:!1,style:{height:"620px"},"flex-height":"","scroll-x":1e3,pagination:i(d),"row-key":t=>t.uid,"checked-row-keys":p.value,"render-cell":i(j),"onUpdate:checkedRowKeys":ue,"onUpdate:page":ce,"onUpdate:pageSize":ge},null,8,["data","loading","pagination","row-key","checked-row-keys","render-cell"]),[[ye]])]),_:1}),o(z,{"show-form-modal":x.value,"onUpdate:showFormModal":e[8]||(e[8]=t=>x.value=t),"is-async-shut-down":$.value,"onUpdate:isAsyncShutDown":e[9]||(e[9]=t=>$.value=t),"is-show-modal-loading":S.value,"onUpdate:isShowModalLoading":e[10]||(e[10]=t=>S.value=t),"modal-title":i(u)("common.add"),"modal-form-config":y.value,"form-rules":E,onOnSubmit:pe},null,8,["show-form-modal","is-async-shut-down","is-show-modal-loading","modal-title","modal-form-config"]),o(z,{"show-form-modal":k.value,"onUpdate:showFormModal":e[11]||(e[11]=t=>k.value=t),"is-async-shut-down":R.value,"onUpdate:isAsyncShutDown":e[12]||(e[12]=t=>R.value=t),"is-show-modal-loading":M.value,"onUpdate:isShowModalLoading":e[13]||(e[13]=t=>M.value=t),"modal-title":i(u)("common.modify"),"modal-form-config":C.value,"form-rules":E,onOnSubmit:Y},null,8,["show-form-modal","is-async-shut-down","is-show-modal-loading","modal-title","modal-form-config"]),o(z,{"show-form-modal":L.value,"onUpdate:showFormModal":e[14]||(e[14]=t=>L.value=t),"is-async-shut-down":V.value,"onUpdate:isAsyncShutDown":e[15]||(e[15]=t=>V.value=t),"is-show-modal-loading":D.value,"onUpdate:isShowModalLoading":e[16]||(e[16]=t=>D.value=t),"modal-title":"代理人数","modal-form-config":ae.value,"form-rules":E,"bottom-visible":!1},{levelList:O(()=>[o(U,{remote:"",columns:se,data:A.value,bordered:!1,"max-height":600,"scroll-x":1e3,pagination:i(g),"row-key":t=>t.id,"render-cell":i(j),"onUpdate:page":fe,"onUpdate:pageSize":ve},null,8,["data","pagination","row-key","render-cell"])]),_:1},8,["show-form-modal","is-async-shut-down","is-show-modal-loading","modal-form-config"])])}}});export{ra as default};
