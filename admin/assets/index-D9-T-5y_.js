import{_ as me}from"./modal-form.vue_vue_type_script_setup_true_lang-CUtZP5po.js";import{_ as pe}from"./search-header-HvIjgtEe.js";import{_ as ce}from"./table-header-button-group.vue_vue_type_script_setup_true_lang-D9uBmA4a.js";import{d as ye,O as fe,a9 as _e,r as a,V as ge,o as ve,b as we,f as l,w as p,h as b,B as u,g as f,W as O,a2 as s,a8 as he,Y as F,N as be}from"./index-Cs7V50wn.js";import{g as ke}from"./mentor-management-BoEOM7hR.js";import{g as Me,f as Se,a as Ye,b as De,c as Oe,d as Ne,e as xe}from"./stock-BItHcv3d.js";import{u as Ce}from"./custom-table-UhLLoG9d.js";import{_ as T}from"./Flex-DDwAcRM-.js";import{_ as Fe}from"./DataTable-CAMJVhuk.js";import{_ as Te}from"./Spin-DmemDANO.js";import"./multi-language-form.vue_vue_type_script_setup_true_lang-COSYJ2fD.js";import"./custom-upload-C27QY7jd.js";import"./Grid-qWmwYo8c.js";import"./get-slot-Bk_rJcZu.js";import"./FormItem-BBZRA4Hq.js";import"./DatePicker-KOWWGRFd.js";import"./TimePicker-BJqFFLdw.js";import"./Forward-C8rBN4KN.js";import"./RadioGroup-B0NwJwJi.js";import"./Space-C9n6suaS.js";const et=ye({name:"documentation-management_order-record",__name:"index",setup(Le){const{pagination:d,renderCell:E}=Ce(),N=fe(),L=_e(),V=L.query.id,P=L.query.order_id,c=a({trader_record_id:V,order_id:P,user_type:"1"}),R=a(""),k=a([{type:"Input",valueName:"order_no",label:"订单号"},{type:"Input",valueName:"account",label:"账号/姓名"},{type:"Input",valueName:"stock_name",label:"股票名称"},{type:"Input",valueName:"stock_code",label:"股票代码"},{type:"Remote Select",valueName:"trader_id",label:"导师",selectLabelField:"name",selectValueField:"value",remoteSelectLoading:!1},{type:"Select",valueName:"order_type",label:"订单类型",defaultOption:[{label:"全部",value:0},{label:"单日跟单",value:1},{label:"多日跟单",value:2}]},{type:"Select",valueName:"operate_status",label:"状态",defaultOption:[{label:"已买入",value:2},{label:"已卖出",value:3},{label:"已结算",value:4}]},{type:"Select",valueName:"user_type",label:"用户类型",defaultOption:[{label:"正式用户",value:1},{label:"试玩用户",value:2}]},{type:"Select",valueName:"is_compensate",label:"补偿状态",defaultOption:[{label:"已补偿",value:1},{label:"待补偿",value:2}]},{type:"Datetime",datetimeType:"datetimerange",valueName:"buy_time",label:"买入时间"},{type:"Datetime",datetimeType:"datetimerange",valueName:"sell_time",label:"卖出时间"}]),_=a(!1),U=a([]),j=a(),r=a(),i=a([]),M=a([]),g=a(!1),z=a(!0),S=a(!1),v=a(!1),q=a(!0),Y=a(!1),w=a(!1),I=a(!0),A=a(!1),H=a(null),x=a(!1),K=a([{type:"Input",valueName:"rate",label:"订单买入总价补收益百分比"},{type:"Input",inputType:"password",valueName:"pwd",label:"登录密码"}]),G={rate:[{required:!0,message:"请输入订单买入总价补收益百分比",trigger:["blur"]}],pwd:[{required:!0,message:"请输入登录密码",trigger:["blur"]}]},Q=a([{type:"Input",inputType:"password",valueName:"pwd",label:"登录密码"}]),W={pwd:[{required:!0,message:"请输入登录密码",trigger:["blur"]}]},X=a([{type:"Input Number",valueName:"sell_price",label:"卖出价格",placeholder:"请输入卖出价格"},{type:"Datetime",datetimeType:"date",valueName:"sell_time",label:"卖出时间"}]),J={sell_price:[{required:!0,type:"float",trigger:["blur"],validator:(e,t)=>t?t<=0?new Error("请输入卖出价格需大于0"):!0:new Error("请输入卖出价格")}],sell_time:[{required:!0,type:"date",message:"请选卖出时间",trigger:["blur"]}]};async function m(){var t,n,y,D;_.value=!0;const{data:e}=await Me({...c.value,buy_time:Array.isArray((t=c.value)==null?void 0:t.buy_time)?(n=c.value)==null?void 0:n.buy_time.map(h=>s(h).format("YYYY/MM/DD")).join("-"):void 0,sell_time:Array.isArray((y=c.value)==null?void 0:y.sell_time)?(D=c.value)==null?void 0:D.sell_time.map(h=>s(h).format("YYYY/MM/DD")).join("-"):void 0,page:d.page,limit:d.pageSize});U.value=e.list,d.itemCount=e.count,_.value=!1}const B=[{type:"selection"},{title:"ID",key:"id",align:"center",width:"50"},{title:"股票交易日期",key:"deal_date",align:"center",width:"120",render:e=>e.deal_date?s(e.deal_date).format("YYYY-MM-DD"):""},{title:"订单号",key:"order_no",align:"center",width:"230",render:e=>e.order_no||""},{title:"账号/姓名",key:"account",align:"center",width:"120",render:e=>l(T,{justify:"center"},{default:()=>[l("p",null,[e.account_name||""]),l("p",null,[e.account||""])]})},{title:"正式用户",key:"user_type",align:"center",width:"100",render:e=>l(he,{type:e.user_type===1?"success":"error"},{default:()=>[e.user_type===1?"是":"否"]})},{title:"股票代码",key:"stock_code",align:"center",width:"100"},{title:"股票名称",key:"stock_name",align:"center",width:"100"},{title:"市场",key:"market_type_name",align:"center",width:"80"},{title:"币种",key:"money_type_name",align:"center",width:"80"},{title:"导师",key:"trader_id",align:"center",width:"100",render:e=>{var n;const t=(n=j.value)==null?void 0:n.find(y=>y.value===e.trader_id);return(t==null?void 0:t.label)||""}},{title:"讲师佣金比",key:"trader_commission_ratio",align:"center",width:"100"},{title:"买入总价",key:"buy_sum",align:"center",width:"100"},{title:"数量",key:"num",align:"center",width:"100"},{title:"买入时间",key:"buy_time",align:"center",width:"100",render:e=>e.buy_time?s(e.buy_time).format("YYYY-MM-DD"):""},{title:"买入价格",key:"buy_price",align:"center",width:"100"},{title:"卖出操作时间",key:"exe_sell_time",align:"center",width:"120",render:e=>e.exe_sell_time?s(e.exe_sell_time).format("YYYY-MM-DD"):""},{title:"仓位（%）",key:"position",align:"center",width:"100"},{title:"卖出时间",key:"sell_time",align:"center",width:"100",render:e=>e.sell_time?s(e.sell_time).format("YYYY-MM-DD"):""},{title:"卖出价格",key:"sell_price",align:"center",width:"100"},{title:"卖出总价",key:"sell_sum",align:"center",width:"100"},{title:"利润",key:"profit",align:"center",width:"120"},{title:"买入成本",key:"buy_cost",align:"center",width:"100"},{title:"卖出成本",key:"sell_cost",align:"center",width:"320"},{title:"讲师分润",key:"trader_commission",align:"center",width:"100"},{title:"平台分润",key:"system_commission",align:"center",width:"100",render:e=>e.system_commission||""},{title:"订单类型",key:"order_type",align:"center",width:"100",render:e=>({1:"单日跟单",2:"多日跟单"})[e.order_type]},{title:"智投方案",key:"trader_record_id_text",align:"center",width:"100",render:e=>e.trader_record_id_text||""},{title:"状态",key:"operate_status",align:"center",width:"100",render:e=>{const t={1:["待买入","warning"],2:["已买入","info"],3:["已卖出","success"],4:["已结算","error"]},n=t[e.operate_status];return l(u,{quaternary:!0,type:t[e.operate_status][1]||"info"},{default:()=>[n[0]]})}},{title:"生成时间",key:"create_time",align:"center",width:"100",render:e=>e.create_time?s(e.create_time).format("YYYY-MM-DD"):""},{title:"补偿状态",key:"is_compensate",align:"center",width:"100",render:e=>{const t={2:["待补偿","error"],1:["已补偿","primary"]};return l(u,{quaternary:!0,type:t[e.is_compensate][1]||"info"},{default:()=>[t[e.is_compensate][0]]})}},{title:"操作用户补偿时间",key:"compensate_time",align:"center",width:"100",render:e=>e.compensate_time?s(e.compensate_time).format("YYYY-MM-DD"):""},{title:"补贴状态",key:"is_subsidy",align:"center",width:"100",render:e=>l(u,{quaternary:!0,type:e.is_subsidy===1?"primary":"error"},{default:()=>[e.is_subsidy===1?"已补贴":"待补贴"]})},{title:"操作用户/补贴时间",key:"subsidy_time",align:"center",width:"100",render:e=>e.subsidy_time?s(e.subsidy_time).format("YYYY-MM-DD"):""},{title:"操作",key:"action",align:"center",width:300,fixed:"right",render:e=>l(T,{justify:"center"},{default:()=>[O(l(u,{type:"success",size:"small",onClick:()=>{r.value=e.id,g.value=!0}},{default:()=>[f("补贴收益")]}),[[F,e.operate_status===4]]),O(l(u,{type:"warning",size:"small",onClick:()=>{v.value=!0,r.value=e.id}},{default:()=>[f("补偿亏损")]}),[[F,e.is_compensate===2&&e.profit<0&&e.operate_status===4]]),O(l(u,{type:"primary",size:"small",onClick:()=>{r.value=e.id,w.value=!0}},{default:()=>[f("卖出")]}),[[F,e.operate_status===2]])]})}];function Z(e,t){i.value=e,M.value=t}function ee(e){d.page=e,m()}function te(e){d.page=1,d.pageSize=e,m()}function ae(e){c.value=e,d.page=1,m()}async function $(){k.value[4].remoteSelectLoading=!0;const{data:e}=await ke({name:R.value});j.value=e.map(t=>({label:t.name,value:t.value})),k.value[4].defaultOption=e,k.value[4].remoteSelectLoading=!1}function le(e){e.keyName==="trader_id"&&(R.value=e.value,$())}async function oe(e){S.value=!0;const t={};e.up_where&&(t.up_where=e.up_where.join(","));const{response:n}=r.value?await Se({...e,...t,id:`${r.value}`}):await Ye({...e,...t,ids:i.value.join(",")});n.data.status===200&&(i.value=[],M.value=[],m(),N.success("补贴收益成功"),g.value=!1),S.value=!1}async function ne(e){Y.value=!0;const t={};e.up_where&&(t.up_where=e.up_where.join(","));const{response:n}=r.value?await De({...e,...t,id:`${r.value}`}):await Oe({...e,...t,ids:i.value.join(",")});n.data.status===200&&(r.value=void 0,i.value=[],M.value=[],m(),N.success("补偿亏损成功"),v.value=!1),Y.value=!1}async function re(e){x.value=!0;const t={};e.up_where&&(t.up_where=e.up_where.join(","));const{response:n}=r.value||r.value===0?await Ne({id:`${r.value}`,...e,...t,sell_time:s(e.sell_time).format("YYYY-MM-DD")}):await xe({...e,...t,ids:i.value.join(",")});n.data.status===200&&(r.value=void 0,i.value=[],M.value=[],m(),N.success("卖出成功"),w.value=!1),x.value=!1}$(),m();const ie=a(B.reduce((e,t)=>Number(e)+Number(t.width),0));return(e,t)=>{const n=T,y=ce,D=pe,h=Fe,se=be,C=me,ue=Te,de=ge("resize");return ve(),we("div",null,[l(ue,{show:x.value},{default:p(()=>[l(se,{title:"下单记录(卖出)列表"},{"header-extra":p(()=>[l(y,{"refresh-button-loading":_.value,"onUpdate:refreshButtonLoading":t[3]||(t[3]=o=>_.value=o),"is-add":!1,"is-batch-delete":!1,"is-export-all":!1,"is-export-filter":!1,"is-export-selected":!1,"slot-name":"bars",onRefresh:m},{bars:p(()=>[l(n,{justify:"center"},{default:p(()=>[l(b(u),{size:"small",ghost:"",type:"success",disabled:!i.value.length,onClick:t[0]||(t[0]=()=>{g.value=!0})},{default:p(()=>t[13]||(t[13]=[f(" 批量补贴收益 ")])),_:1},8,["disabled"]),l(b(u),{size:"small",ghost:"",type:"primary",disabled:!i.value.length,onClick:t[1]||(t[1]=()=>{v.value=!0})},{default:p(()=>t[14]||(t[14]=[f(" 批量补偿亏损 ")])),_:1},8,["disabled"]),l(b(u),{size:"small",ghost:"",type:"error",disabled:!i.value.length,onClick:t[2]||(t[2]=()=>{w.value=!0})},{default:p(()=>t[15]||(t[15]=[f(" 批量卖出 ")])),_:1},8,["disabled"])]),_:1})]),_:1},8,["refresh-button-loading"])]),default:p(()=>[l(D,{"search-config":k.value,onOnSearch:ae,onOnRemoteSelectSearch:le},null,8,["search-config"]),O(l(h,{remote:"",columns:B,data:U.value,loading:_.value,bordered:!1,style:{height:"500px"},"flex-height":"","scroll-x":ie.value,pagination:b(d),"row-key":o=>o.id,"render-cell":b(E),"checked-row-keys":i.value,"onUpdate:checkedRowKeys":Z,"onUpdate:page":ee,"onUpdate:pageSize":te},null,8,["data","loading","scroll-x","pagination","row-key","render-cell","checked-row-keys"]),[[de]])]),_:1}),l(C,{"show-form-modal":g.value,"onUpdate:showFormModal":t[4]||(t[4]=o=>g.value=o),"is-async-shut-down":z.value,"onUpdate:isAsyncShutDown":t[5]||(t[5]=o=>z.value=o),"is-show-modal-loading":S.value,"onUpdate:isShowModalLoading":t[6]||(t[6]=o=>S.value=o),"modal-title":"补贴收益","modal-form-config":K.value,"form-rules":G,onOnSubmit:oe},null,8,["show-form-modal","is-async-shut-down","is-show-modal-loading","modal-form-config"]),l(C,{"show-form-modal":v.value,"onUpdate:showFormModal":t[7]||(t[7]=o=>v.value=o),"is-async-shut-down":q.value,"onUpdate:isAsyncShutDown":t[8]||(t[8]=o=>q.value=o),"is-show-modal-loading":Y.value,"onUpdate:isShowModalLoading":t[9]||(t[9]=o=>Y.value=o),"modal-title":"补偿亏损","modal-form-config":Q.value,"form-rules":W,onOnSubmit:ne},null,8,["show-form-modal","is-async-shut-down","is-show-modal-loading","modal-form-config"]),l(C,{ref_key:"sellModalFormRef",ref:H,"show-form-modal":w.value,"onUpdate:showFormModal":t[10]||(t[10]=o=>w.value=o),"is-async-shut-down":I.value,"onUpdate:isAsyncShutDown":t[11]||(t[11]=o=>I.value=o),"is-show-modal-loading":A.value,"onUpdate:isShowModalLoading":t[12]||(t[12]=o=>A.value=o),"modal-title":"卖出","modal-form-config":X.value,"form-rules":J,onOnSubmit:re},null,8,["show-form-modal","is-async-shut-down","is-show-modal-loading","modal-form-config"])]),_:1},8,["show"])])}}});export{et as default};
