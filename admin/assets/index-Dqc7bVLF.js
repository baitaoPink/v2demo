import{_ as he}from"./modal-form.vue_vue_type_script_setup_true_lang-tU3-hIUf.js";import{_ as we}from"./delete-B0ioC2MT.js";import{_ as xe}from"./search-header-BEaDoZth.js";import{_ as ke}from"./table-header-button-group.vue_vue_type_script_setup_true_lang-C-DfQuFh.js";import{d as Se,O as Ne,r as o,U as y,o as w,b as q,f as n,w as b,h as s,a1 as I,c as W,a4 as U,e as Y,B as F,$ as p,a3 as De,X as Ce,N as Le,Z as Me,a6 as Ae}from"./index-ClXc60Q8.js";import{c as ee,f as Ue,h as Fe,i as Oe,j as Ee,k as Be,l as Re}from"./article-manage-AgCzHMfG.js";import{g as $e}from"./mentor-management-CKAPFC4o.js";import{u as qe,N as Ie}from"./custom-table-DLqvKnHZ.js";import{u as Te}from"./exportExcel-BkPY8vZC.js";import{_ as je,u as ze}from"./custom-upload-D71Q5maP.js";import{_ as Ve}from"./Flex-CESa1CD9.js";import{_ as Pe}from"./DataTable-C2iu46cC.js";import"./multi-language-form.vue_vue_type_script_setup_true_lang-Ddf5h8QK.js";import"./Grid-xFIQOVry.js";import"./get-slot-Bk_rJcZu.js";import"./FormItem-DwRTykPn.js";import"./Spin-B3LvPL2m.js";import"./DatePicker-uVn2PEEJ.js";import"./TimePicker-Kfakx9-p.js";import"./Forward-BysZYGA1.js";import"./RadioGroup-C9SrcqWM.js";import"./Space-BoszUUx1.js";const He={key:1,class:"video-box"},Ke=["src"],Ge={key:1,class:"video-box"},Qe=["src"];function te(x){return typeof x=="function"||Object.prototype.toString.call(x)==="[object Object]"&&!Me(x)}const T="文章分类.xlsx",Xe=Se({name:"article-manage_service-agreement",__name:"index",setup(x){const{pagination:m,renderCell:ae}=qe(),k=Ne(),{handleUpload:le}=ze(),{exportExcel:O,exportLoading:r}=Te(),v=o(!1),E=o([]),j=o({}),i=o([]),f=o({}),oe=o([{label:"全部",value:""},{label:"显示",value:2},{label:"隐藏",value:1}]),z=o([{type:"Input",valueName:"title",label:"文章标题",placeholder:"请输入文章标题"},{type:"Select",valueName:"category_id",label:"文章分类",placeholder:"请选择文章分类",defaultOption:[],selectFilter:!0},{type:"Select",valueName:"status",label:"状态",placeholder:"请选择状态",defaultOption:oe.value}]),B=o(0),S=o(!1),V=o(!0),N=o(!1),ne=o({}),D=o(!1),P=o(!0),C=o(!1),u=o([{type:"Input",valueName:"title",label:"文章标题"},{type:"Select",valueName:"lang_code",label:"语言"},{type:"Select",valueName:"category_id",label:"文章分类",selectFilter:!0},{type:"Select",valueName:"trader_id",label:"导师选择",selectFilter:!0},{type:"Input",valueName:"sub_title",label:"简略标题"},{type:"Input",valueName:"describe",inputType:"textarea",label:"摘要"},{type:"Input",inputType:"textarea",valueName:"content",label:"内容"},{type:"Input Number",valueName:"sort",label:"排序"},{type:"Select",valueName:"status",label:"状态",defaultOption:[{value:2,label:"开启"},{value:1,label:"关闭"}]},{type:"Slot",valueName:"video",label:"视频",slotName:"video"}]),L=o([]),_=o([]),H={title:[{required:!0,message:"请输入文章标题",trigger:["blur"]}],category_id:[{required:!0,type:"number",message:"请选择文章分类",trigger:["blur"]}],lang_code:[{required:!0,message:"请选择语言",trigger:["blur"]}],sub_title:[{required:!0,message:"请输入简略标题",trigger:["blur"]}],describe:[{required:!0,message:"请输入摘要",trigger:["blur"]}],content:[{required:!0,message:"请输入内容",trigger:["blur"]}]};async function d(){v.value=!0;const{data:t}=await ee({...j.value,page:m.page,limit:m.pageSize});E.value=t.list,m.itemCount=t.count,v.value=!1}async function ie(t){v.value=!0;const{response:e}=await Be({id:t});e.data.status===200&&(d(),k.success(p("common.deleteSuccess")))}async function se(t){B.value=t;const{data:e}=await Re({id:t});ne.value=e,_.value=y(u.value),_.value.forEach(l=>{l.defaultValue=e[l.valueName]}),e.video?(i.value=[{id:"video",name:"视频",url:e.video,status:"finished"}],f.value.video=e.video||""):(f.value.video="",i.value=[]),D.value=!0}async function ue(){const{data:t}=await Ue(),e=t.map(l=>({value:l.value,label:l.name}));z.value[1].defaultOption=e,u.value[2].defaultOption=e}async function re(){var e;const{data:t}=await De();u.value[1].defaultOption=(e=t.list)==null?void 0:e.map(l=>({value:l.file_name,label:l.language_name}))}re(),ue();const M=[{type:"selection"},{title:"ID",key:"id",align:"center",width:"50"},{title:"分类名称",key:"category_name",align:"center",width:"200"},{title:"语言",key:"lang_code",align:"center",width:"100"},{title:"标题",key:"title",align:"center",width:"200",ellipsis:{tooltip:!0}},{title:"简略标题",key:"sub_title",align:"center",width:"200",ellipsis:{tooltip:!0}},{title:"摘要",key:"describe",align:"center",width:"200",ellipsis:{tooltip:!0}},{title:"内容",key:"content",align:"center",width:"200",ellipsis:{tooltip:!0}},{title:"排序",key:"sort",align:"center",width:"100"},{title:"状态",key:"up_where",align:"center",width:"100",render:t=>{const e=o(t.status===1);return n(Ce,{value:e.value,"onUpdate:value":[l=>e.value=l,l=>{t.status=l?1:0,B.value=t.id,G({...t,status:l})}]},null)}},{title:"创建时间",key:"create_time",align:"center",width:"180"},{title:"操作",key:"action",align:"center",width:300,fixed:"right",render:t=>{let e;return n(Ve,{justify:"center"},{default:()=>[n(F,{type:"success",size:"small",onClick:se.bind(null,t.id)},te(e=p("common.modify"))?e:{default:()=>[e]}),n(Ie,{"onPositive-click":ie.bind(null,t.id)},{default:()=>[p("common.confirmDelete")],trigger:()=>{let l;return n(F,{type:"error",size:"small"},te(l=p("common.delete"))?l:{default:()=>[l]})}})]})}}];async function de(){const{data:t}=await ee();O({tableColumns:M,tableData:R(t),fileName:T})}function R(t){const e=t;return e.forEach(l=>{l.up_where}),e}const c=o([]),K=o([]);function ce(t){j.value=t,m.page=1,d()}function pe(t,e){c.value=t,K.value=e}function me(){L.value=y(u.value),S.value=!0,f.value.video="",i.value=[]}async function ve(){v.value=!0;const{response:t}=await Fe({id:c.value.join(",")});t.data.status===200&&(d(),c.value=[],k.success(p("common.deleteSuccess")))}async function fe(t){N.value=!0;const e={};t.up_where&&(e.up_where=t.up_where.join(","));const{response:l}=await Oe({...t,...e,status:t.status?1:0});l.data.status===200&&(d(),k.success(p("common.addSuccess"))),S.value=!1,N.value=!1}async function G(t){C.value=!0;const e={};t.up_where&&(e.up_where=t.up_where.join(","));const{response:l}=await Ee(B.value,{...t,...e,status:t.status?1:0,video:f.value.video});l.data.status===200&&(d(),k.success(p("common.modifySuccess"))),D.value=!1,C.value=!1}function A(t){Reflect.deleteProperty(f.value,t),i.value=[],f.value[t]=""}async function Q({file:t,onFinish:e,onError:l,onProgress:g}){const h=await le({file:t,onFinish:e,onError:l,onProgress:g});h&&(f.value.video=h,i.value=[{id:"video",name:"视频",url:h,status:"finished"}])}async function ge(){const{data:t}=await $e();u.value.forEach((e,l)=>{e.valueName==="trader_id"&&(u.value[l].defaultOption=t.map(g=>({label:g.name,value:g.value})))}),L.value=y(u.value),_.value=y(u.value)}ge();function ye(t){m.page=t,d()}function be(t){m.page=1,m.pageSize=t,d()}return d(),L.value=y(u.value),_.value=y(u.value),(t,e)=>{const l=ke,g=xe,h=Pe,_e=Le,X=je,Z=we,J=he;return w(),q("div",null,[n(_e,{title:"文章列表"},{"header-extra":b(()=>[n(l,{"export-all-loading":s(r),"onUpdate:exportAllLoading":e[0]||(e[0]=a=>I(r)?r.value=a:null),"refresh-button-loading":v.value,"onUpdate:refreshButtonLoading":e[1]||(e[1]=a=>v.value=a),"export-selected-disabled":c.value.length,"onUpdate:exportSelectedDisabled":e[2]||(e[2]=a=>c.value.length=a),"batch-delete-disabled":c.value.length,"onUpdate:batchDeleteDisabled":e[3]||(e[3]=a=>c.value.length=a),"export-filter-loading":s(r),"onUpdate:exportFilterLoading":e[4]||(e[4]=a=>I(r)?r.value=a:null),"export-selected-loading":s(r),"onUpdate:exportSelectedLoading":e[5]||(e[5]=a=>I(r)?r.value=a:null),"is-export-all":!1,"is-export-filter":!1,"is-export-selected":!1,"checked-row-keys":c.value,onExportAll:de,onExportFilter:e[6]||(e[6]=a=>s(O)({tableColumns:M,tableData:R(E.value),fileName:T})),onExportSelected:e[7]||(e[7]=a=>s(O)({tableColumns:M,tableData:R(K.value),fileName:T})),onAdd:me,onBatchDelete:ve,onRefresh:d},null,8,["export-all-loading","refresh-button-loading","export-selected-disabled","batch-delete-disabled","export-filter-loading","export-selected-loading","checked-row-keys"])]),default:b(()=>[n(g,{"search-config":z.value,onOnSearch:ce},null,8,["search-config"]),n(h,{remote:"",columns:M,data:E.value,loading:v.value,bordered:!1,"max-height":600,"scroll-x":1e3,pagination:s(m),"row-key":a=>a.id,"render-cell":s(ae),"checked-row-keys":c.value,"onUpdate:checkedRowKeys":pe,"onUpdate:page":ye,"onUpdate:pageSize":be},null,8,["data","loading","pagination","row-key","render-cell","checked-row-keys"])]),_:1}),n(J,{"show-form-modal":S.value,"onUpdate:showFormModal":e[10]||(e[10]=a=>S.value=a),"is-async-shut-down":V.value,"onUpdate:isAsyncShutDown":e[11]||(e[11]=a=>V.value=a),"is-show-modal-loading":N.value,"onUpdate:isShowModalLoading":e[12]||(e[12]=a=>N.value=a),"modal-title":s(p)("common.add"),"modal-form-config":L.value,"form-rules":H,onOnSubmit:fe},{video:b(()=>{var a;return[i.value.length===0?(w(),W(X,{key:0,max:1,"list-type":"image-card","custom-request":Q,placeholder:"上传视频",accept:"video/*",onRemove:e[8]||(e[8]=$=>A("video"))})):U("",!0),i.value.length>0?(w(),q("div",He,[Y("video",{src:((a=i.value[0])==null?void 0:a.url)||void 0,controls:""},null,8,Ke),n(s(F),{strong:"",circle:"",size:"small",type:"error",class:"delete-icon",onClick:e[9]||(e[9]=$=>A("video"))},{icon:b(()=>[n(Z,{class:"text-icon"})]),_:1})])):U("",!0)]}),_:1},8,["show-form-modal","is-async-shut-down","is-show-modal-loading","modal-title","modal-form-config"]),n(J,{"show-form-modal":D.value,"onUpdate:showFormModal":e[15]||(e[15]=a=>D.value=a),"is-async-shut-down":P.value,"onUpdate:isAsyncShutDown":e[16]||(e[16]=a=>P.value=a),"is-show-modal-loading":C.value,"onUpdate:isShowModalLoading":e[17]||(e[17]=a=>C.value=a),"modal-title":s(p)("common.modify"),"modal-form-config":_.value,"form-rules":H,onOnSubmit:G},{video:b(()=>{var a;return[i.value.length===0?(w(),W(X,{key:0,max:1,"list-type":"image-card","custom-request":Q,placeholder:"上传视频",accept:"video/*",onRemove:e[13]||(e[13]=$=>A("video"))})):U("",!0),i.value.length>0?(w(),q("div",Ge,[Y("video",{src:((a=i.value[0])==null?void 0:a.url)||void 0,controls:""},null,8,Qe),n(s(F),{strong:"",circle:"",size:"small",type:"error",class:"delete-icon",onClick:e[14]||(e[14]=$=>A("video"))},{icon:b(()=>[n(Z,{class:"text-icon"})]),_:1})])):U("",!0)]}),_:1},8,["show-form-modal","is-async-shut-down","is-show-modal-loading","modal-title","modal-form-config"])])}}}),bt=Ae(Xe,[["__scopeId","data-v-85584c6c"]]);export{bt as default};
