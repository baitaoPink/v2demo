import{a0 as f,d as B,O as W,r as n,U as x,o as k,b as C,f as l,w as c,h as N,S as Y,ac as ee,$ as v,X as te,g as h,B as F,N as I,a5 as ae,Z as ne,c as oe,cr as se,t as U,bq as le,a6 as ue}from"./index-ClXc60Q8.js";import{_ as ie}from"./modal-form.vue_vue_type_script_setup_true_lang-tU3-hIUf.js";import{u as ce,N as de}from"./custom-table-DLqvKnHZ.js";import{_ as D}from"./Flex-CESa1CD9.js";import{_ as re}from"./DataTable-C2iu46cC.js";import{_ as me}from"./Spin-B3LvPL2m.js";import"./multi-language-form.vue_vue_type_script_setup_true_lang-Ddf5h8QK.js";import"./custom-upload-D71Q5maP.js";import"./Grid-xFIQOVry.js";import"./get-slot-Bk_rJcZu.js";import"./FormItem-DwRTykPn.js";import"./DatePicker-uVn2PEEJ.js";import"./TimePicker-Kfakx9-p.js";import"./Forward-BysZYGA1.js";import"./RadioGroup-C9SrcqWM.js";import"./Space-BoszUUx1.js";function pe(o){return f({url:"/system/system/crontab/list",params:o})}function fe(o){return f({url:`/system/system/crontab/info/${o}`})}function ye(o){return f({url:"/system/system/crontab/save",method:"post",data:o})}function _e(o,u){return f({url:`/system/system/crontab/set_open/${o}/${u}`})}function ge(o){return f({url:`/system/system/crontab/execute/${o}`,method:"post"})}function ve(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!ne(o)}const he=B({name:"SystemTaks",__name:"system-task",setup(o){const{pagination:u,renderCell:y}=ce(),r=W(),m=n(!1),b=n([]),S=n(""),i=n(1),s=n({}),M=n(0),L=n({}),_=n(!1),T=n(!0),g=n(!1),$=n([{type:"Input",valueName:"name",label:"任务名称"},{type:"Slot",valueName:"type",label:"执行周期",slotName:"type"},{type:"Input",inputType:"textarea",valueName:"content",label:"任务说明"},{type:"Switch",valueName:"is_open",label:"状态",switchChecked:1,switchUnchecked:0,switchCheckedText:"开启",switchUncheckedText:"关闭"}]),w=n([]),E={name:[{required:!0,message:"请输入任务名称",trigger:["blur"]}],type:[{required:!0,message:"请输入执行周期",trigger:["blur"],validator:()=>Object.values(s.value).filter(t=>t!==null&&t>0).length?!0:new Error("请输入执行周期")}]},O=[{type:1,name:"每隔N秒"},{type:2,name:"每隔N分钟"},{type:3,name:"每隔N小时"},{type:4,name:"每隔N天"},{type:5,name:"每天N点执行"},{type:6,name:"每周周N M点执行"},{type:7,name:"每月N号 M点执行"}],z={1:[{name:"秒",fields:"second"}],2:[{name:"分",fields:"minute"},{name:"秒",fields:"second"}],3:[{name:"时",fields:"hour"},{name:"分",fields:"minute"},{name:"秒",fields:"second"}],4:[{name:"天",fields:"day"},{name:"时",fields:"hour"},{name:"分",fields:"minute"},{name:"秒",fields:"second"}],5:[{name:"时",fields:"hour"},{name:"分",fields:"minute"},{name:"秒",fields:"second"}],6:[{name:"周",fields:"week"},{name:"时",fields:"hour"},{name:"分",fields:"minute"},{name:"秒",fields:"second"}],7:[{name:"月",fields:"month"},{name:"时",fields:"hour"},{name:"分",fields:"minute"},{name:"秒",fields:"second"}]};async function p(){m.value=!0;const{data:t}=await pe({page:u.page,limit:u.pageSize});b.value=t.list.map(e=>({...e})),u.itemCount=t.count,m.value=!1}function j(t){u.page=t,p()}function A(t){u.page=1,u.pageSize=t,p()}async function P(t){const{response:e}=await ge(t);e.data.status===200&&(p(),r.success("触发定时任务成功"))}async function V(t){M.value=t;const{data:e}=await fe(t);switch(L.value=e,w.value.forEach(d=>{d.defaultValue=e[d.valueName]}),S.value=e.mark,i.value=e.type,e.type){case 1:s.value={second:e.second};break;case 2:s.value={second:e.second,minute:e.minute};break;case 3:s.value={second:e.second,minute:e.minute,hour:e.hour};break;case 4:s.value={second:e.second,minute:e.minute,hour:e.hour,day:e.day};break;case 5:s.value={second:e.second,minute:e.minute,hour:e.hour};break;case 6:s.value={second:e.second,minute:e.minute,hour:e.hour,week:e.week};break;case 7:s.value={second:e.second,minute:e.minute,hour:e.hour,month:e.month};break}_.value=!0}const q=[{title:"标题",key:"name",align:"center"},{title:"任务说明",key:"content",align:"center"},{title:"执行周期",key:"execution_str",align:"center"},{title:"是否开启",key:"is_open",align:"center",render:t=>l(te,{value:t.is_open,"onUpdate:value":e=>t.is_open=e,"checked-value":1,"unchecked-value":0,loading:t.statusLoading,"on-update:value":()=>R(t)},null)},{title:"上次执行时间",key:"last_execution_time",align:"center"},{title:"下次执行时间",key:"next_execution_time",align:"center"},{title:"操作",key:"action",align:"center",width:300,fixed:"right",render:t=>{let e;return l(D,{justify:"center"},{default:()=>[l(de,{"onPositive-click":P.bind(null,t.id)},{default:()=>[h("确定要触发定时任务吗？")],trigger:()=>l(F,{type:"primary",size:"small"},{default:()=>[h("触发")]})}),l(F,{type:"success",size:"small",onClick:V.bind(null,t.id)},ve(e=v("common.modify"))?e:{default:()=>[e]})]})}}];async function R(t){t.statusLoading=!0;let e=0;t.is_open===0?e=1:e=0;const{response:d}=await _e(t.id,e);d.data.status===200&&(t.is_open=e,r.success(v("common.modifySuccess"))),t.statusLoading=!1}async function X(t){g.value=!0;const{response:e}=await ye({id:M.value,mark:S.value,...t,type:i.value,...s.value});e.data.status===200&&(p(),r.success(v("common.modifySuccess")),_.value=!1),g.value=!1}return p(),w.value=x($.value),(t,e)=>{const d=re,Z=I,G=ae,H=le,J=D,K=ie;return k(),C("div",null,[l(Z,{bordered:!1},{default:c(()=>[l(d,{remote:"",columns:q,data:b.value,loading:m.value,bordered:!1,style:{height:"640px"},"flex-height":"","scroll-x":1e3,pagination:N(u),"row-key":a=>a.id,"render-cell":N(y),"onUpdate:page":j,"onUpdate:pageSize":A},null,8,["data","loading","pagination","row-key","render-cell"])]),_:1}),l(K,{"show-form-modal":_.value,"onUpdate:showFormModal":e[1]||(e[1]=a=>_.value=a),"is-async-shut-down":T.value,"onUpdate:isAsyncShutDown":e[2]||(e[2]=a=>T.value=a),"is-show-modal-loading":g.value,"onUpdate:isShowModalLoading":e[3]||(e[3]=a=>g.value=a),"modal-title":N(v)("common.modify"),"modal-form-config":w.value,"form-rules":E,onOnSubmit:X},{type:c(()=>[l(J,null,{default:c(()=>[l(G,{value:i.value,"onUpdate:value":e[0]||(e[0]=a=>i.value=a),class:"w-193px",options:O,"label-field":"name","value-field":"type"},null,8,["value"]),(k(!0),C(Y,null,ee(z[i.value],a=>(k(),oe(H,{key:a.name,value:s.value[a.fields],"onUpdate:value":Q=>s.value[a.fields]=Q,class:"w-70px","show-button":!1},se({_:2},[a.fields!=="week"?{name:"suffix",fn:c(()=>[h(U(a.name),1)]),key:"0"}:{name:"prefix",fn:c(()=>[h(U(a.name),1)]),key:"1"}]),1032,["value","onUpdate:value"]))),128))]),_:1})]),_:1},8,["show-form-modal","is-async-shut-down","is-show-modal-loading","modal-title","modal-form-config"])])}}}),ke=ue(he,[["__scopeId","data-v-dd34c846"]]),Oe=B({name:"system-config_scheduled-tasks",__name:"index",setup(o){const u=n(!1),y=n([{type:"Input",valueName:"add_ip",label:"IP"},{type:"Input",valueName:"mark",label:"备注"}]),r=n([]),m=n([]);return r.value=x(y.value),m.value=x(y.value),(b,S)=>{const i=me,s=I;return k(),C("div",null,[l(s,{title:"定时任务管理"},{default:c(()=>[l(i,{show:u.value},{default:c(()=>[l(ke)]),_:1},8,["show"])]),_:1})])}}});export{Oe as default};
