import{d as B,r as d,q as L,O as M,o as R,c as C,w as n,f as a,v as F,P as I,g as c,e as q,t as A,h as V,$ as O,x as $,B as K,N as P}from"./index-BGn2hxht.js";import{g as T,a as j}from"./administrator-CUGW8Rn-.js";import{_ as z,u as D}from"./custom-upload-BnYTuu-H.js";import{_ as E}from"./Spin-CneC0ahg.js";import{_ as G,a as H}from"./FormItem-hAQEuGNb.js";const J={class:"ml-44 w-280px"},ae=B({name:"administrator_administrator-info",__name:"index",setup(Q){const m=d(null),t=d({}),v={real_name:[{required:!0,message:"请输入真实姓名",trigger:["blur"]}]},i=d({}),p=d([]),f=L(),w=M(),{handleUpload:g}=D(),_=d(!1);function y(){Reflect.deleteProperty(i.value,"head_pic")}async function h(){const{data:o}=await T();t.value.real_name=o.real_name,o.head_pic&&(i.value.head_pic=o.head_pic.name,p.value=[{id:"head_pic",name:"头像",url:o.head_pic.url,status:"finished"}])}async function b({file:o,onFinish:e,onError:s,onProgress:l}){const r=await g({file:o,onFinish:e,onError:s,onProgress:l});r&&(i.value.head_pic=r)}function N(){var o;(o=m.value)==null||o.validate(async e=>{if(!e){_.value=!0;const s={};Object.keys(i.value).length===1&&(s.head_pic=i.value.head_pic);const{response:l}=await j({...t.value,...s});l.data.status===200&&(w.success("修改成功，请重新登录",{duration:1500}),setTimeout(async()=>{await f.loginOut(),f.resetStore()},1500)),_.value=!1}})}return h(),(o,e)=>{const s=$,l=G,r=z,U=K,x=H,S=P,k=E;return R(),C(k,{show:_.value},{default:n(()=>[a(S,{title:"管理员信息"},{default:n(()=>[a(x,{ref_key:"formRef",ref:m,"label-placement":"left","label-width":"auto",model:t.value,rules:v},{default:n(()=>[a(l,{path:"real_name",label:"真实姓名"},{default:n(()=>[a(s,{value:t.value.real_name,"onUpdate:value":e[0]||(e[0]=u=>t.value.real_name=u),onKeydown:e[1]||(e[1]=F(I(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),a(l,{path:"password",label:"头像"},{default:n(()=>[a(r,{"file-list":p.value,"onUpdate:fileList":e[2]||(e[2]=u=>p.value=u),"list-type":"image-card",max:1,accept:"image/*","custom-request":b,onRemove:y},{default:n(()=>e[6]||(e[6]=[c(" 点击上传 ")])),_:1},8,["file-list"])]),_:1}),a(l,{path:"pwd",label:"当前密码"},{default:n(()=>[a(s,{value:t.value.pwd,"onUpdate:value":e[3]||(e[3]=u=>t.value.pwd=u),type:"password"},null,8,["value"])]),_:1}),a(l,{path:"new_pwd",label:"新密码"},{default:n(()=>[a(s,{value:t.value.new_pwd,"onUpdate:value":e[4]||(e[4]=u=>t.value.new_pwd=u),type:"password"},null,8,["value"])]),_:1}),a(l,{path:"conf_pwd",label:"确认密码"},{default:n(()=>[a(s,{value:t.value.conf_pwd,"onUpdate:value":e[5]||(e[5]=u=>t.value.conf_pwd=u),type:"password"},null,8,["value"])]),_:1}),q("div",J,[a(U,{size:"medium",type:"success",block:"",secondary:"",strong:"",onClick:N},{default:n(()=>[c(A(V(O)("common.modify")),1)]),_:1})])]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])}}});export{ae as default};
