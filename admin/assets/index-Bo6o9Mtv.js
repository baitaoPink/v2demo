import{_ as ve}from"./modal-form.vue_vue_type_script_setup_true_lang-BuDR1X64.js";import{_ as ge}from"./search-header-DC9myRJJ.js";import{_ as ye}from"./table-header-button-group.vue_vue_type_script_setup_true_lang-BqWHjY4C.js";import{a0 as _,d as be,O as we,r as o,U as O,V as he,o as _e,b as xe,f as r,w as h,h as m,a1 as I,W as Se,g as Q,$ as c,K as ke,B as W,a3 as De,N as Ce,Z as Ne}from"./index-DgS_gExp.js";import{a as Ue}from"./user-manage-CXMQLUoa.js";import{u as Me,N as Fe}from"./custom-table-M__G0njN.js";import{u as Le}from"./exportExcel-4g3fAweF.js";import{_ as Ee,u as Ae}from"./custom-upload-DUUdPJxM.js";import{_ as Oe}from"./Flex-NxzTnbAG.js";import{_ as Ie}from"./DataTable-R-3tvq3U.js";import"./multi-language-form.vue_vue_type_script_setup_true_lang-D4ifp7HF.js";import"./Grid-BNV0w0mr.js";import"./get-slot-Bk_rJcZu.js";import"./FormItem-BAqcrsPW.js";import"./Spin-Bu1_C0Z0.js";import"./DatePicker-yC2d8YmP.js";import"./TimePicker-BsIq1gq9.js";import"./Forward-BOBl18BE.js";import"./RadioGroup-C9MN4_Hy.js";import"./Space-CMuvGHTq.js";function Z(n){return _({url:"system/system/customer_service",params:n})}function Re(n){return _({url:"system/system/customer_service",method:"post",data:n})}function $e(n,M){return _({url:`system/system/customer_service/${n}`,method:"put",data:M})}function Ve(n){return _({url:`system/system/customer_service/${n}`})}function qe(n){return _({url:`system/system/customer_service/${n}`,method:"delete"})}function Pe(n){return _({url:"system/system/customer_service/batchDelete",method:"post",params:n})}function J(n){return typeof n=="function"||Object.prototype.toString.call(n)==="[object Object]"&&!Ne(n)}const R="客服列表.xlsx",rt=be({name:"customer-service_list",__name:"index",setup(n){const{handleUpload:M}=Ae(),{pagination:p,renderCell:X}=Me(),C=we(),{exportExcel:F,exportLoading:i}=Le(),v=o(!1),N=o([]),$=o(),Y=o([{type:"Input",valueName:"name",label:"客服名称",placeholder:"请输入客服名称"}]),x=o(0),S=o(!1),V=o(!0),y=o(!1),ee=o({}),k=o(!1),q=o(!0),b=o(!1),P=o([{type:"Input",valueName:"name",label:"客服名称"},{type:"Select",valueName:"lang_code",label:"语言",defaultOption:[]},{type:"Select",valueName:"link_type",label:"链接类型",defaultOption:[{label:"站内",value:1},{label:"外链",value:2}]},{type:"Select",valueName:"status",label:"状态",defaultValue:1,defaultOption:[{label:"显示",value:1},{label:"隐藏",value:2}]},{type:"Input",valueName:"link",label:"客服地址"},{type:"Slot",valueName:"avatar",slotName:"slotImg",label:"客服头像"},{type:"Input Number",valueName:"sort",label:"排序",defaultValue:0}]),w=o([]),D=o([]),g=o({}),z=o([]),L=o([]),B={name:[{required:!0,message:"请输入客服名称",trigger:["blur"]}],link_type:[{required:!0,type:"number",message:"请选择链接类型",trigger:["blur"]}],avatar:[{required:!0,trigger:["blur"],validator:()=>g.value.avatar?!0:new Error("请上客服头像")}],lang_code:[{required:!0,message:"请选择语言",trigger:["blur"]}],link:[{required:!0,trigger:["blur"],validator:(t,e)=>{const l=/^(https?|ftp):\/\/[^\s/$.?#].[^\s]*$/i;return e?e&&!l.test(e)?new Error("请输入正确的客服地址"):!0:new Error("请输入客服地址")}}]};async function u(){v.value=!0;const{data:t}=await Z({...$.value,page:p.page,limit:p.pageSize});p.itemCount=t.count,N.value=t.list,v.value=!1}async function te(t){v.value=!0;const{response:e}=await qe(t);e.data.status===200&&(u(),C.success(c("common.deleteSuccess")))}async function ae(t){x.value=t;const{data:e}=await Ve(t);ee.value=e,D.value.forEach(l=>{l.defaultValue=e[l.valueName],l.valueName==="uid"&&(l.defaultValue=e.uid)}),L.value=[{id:"image",name:"image",url:e.avatar_url,status:"finished"}],g.value.avatar=e.avatar_url,k.value=!0}async function le(){const{data:t}=await Ue(),e=t.map(l=>({label:l.name,value:l.value}));w.value.forEach((l,s)=>{l.valueName==="uid"&&(w.value[s].defaultOption=e,D.value[s].defaultOption=e)})}le();const U=[{type:"selection"},{title:"ID",key:"id",align:"center",width:"80"},{title:"客服名称",key:"name",align:"center",width:"80"},{title:"客服头像",key:"avatar_url",align:"center",width:"100",render:t=>r(ke,{width:"100",src:t.avatar_url},null)},{title:"客服地址",key:"link",align:"center",width:"180",ellipsis:{tooltip:!0}},{title:"语言",key:"lang_code",align:"center",width:"100"},{title:"创建时间",key:"create_time",align:"center",width:"180"},{title:"链接类型",key:"link_type",align:"center",width:"80",render:t=>t.link_type===1?"站内":"外链"},{title:"状态",key:"status",align:"center",width:"80",render:t=>t.status===1?"显示":"隐藏"},{title:"排序",key:"sort",align:"center",width:"60"},{title:"操作",key:"action",align:"center",width:"100",fixed:"right",render:t=>{let e;return r(Oe,{justify:"center"},{default:()=>[r(W,{type:"success",size:"small",onClick:ae.bind(null,t.id)},J(e=c("common.modify"))?e:{default:()=>[e]}),r(Fe,{"onPositive-click":te.bind(null,t.id)},{default:()=>[c("common.confirmDelete")],trigger:()=>{let l;return r(W,{type:"error",size:"small"},J(l=c("common.delete"))?l:{default:()=>[l]})}})]})}}];async function oe(){const{data:t}=await Z(),e=E(t.list);F({tableColumns:U,tableData:e??[],fileName:R})}function E(t){const e=O(t);return e.forEach(l=>{Reflect.has(l,"link_type")&&(l.link_type=l.link_type===1?"站内":"外链"),Reflect.has(l,"status")&&(l.status=l.status===1?"显示":"隐藏")}),e}const f=o([]),T=o([]);function ne(t){$.value=t,p.page=1,u()}function se(t,e){f.value=t,T.value=e}function re(){S.value=!0}async function ie(){v.value=!0;const{response:t}=await Pe({id:f.value.join(",")});t.data.status===200&&(u(),f.value=[],C.success(c("common.deleteSuccess")))}async function ue(t){y.value=!0;const e={};t.up_where&&Array.isArray(t.up_where)&&(e.up_where=t.up_where.join(","));const{response:l}=await Re({...t,...e,...g.value});l.data.status===200&&(u(),C.success(c("common.addSuccess")),S.value=!1),y.value=!1}async function de(t){b.value=!0;const e={};t.up_where&&Array.isArray(t.up_where)&&(e.up_where=t.up_where.join(","));const s={...N.value.find(A=>A.uid===x.value),...t,...e,id:x.value,...g.value};"pwd"in s&&delete s.pwd;const{response:d}=await $e(x.value,{...s});d.data.status===200&&(u(),C.success(c("common.modifySuccess")),k.value=!1),b.value=!1}function me(t){p.page=t,u()}function ce(t){p.page=1,p.pageSize=t,u()}async function j({file:t,onFinish:e,onError:l,onProgress:s}){y.value=S.value,b.value=k.value;const d=await M({file:t,onFinish:e,onError:l,onProgress:s});d&&(g.value.avatar=d),y.value=!1,b.value=!1}function K(t){x.value,Reflect.deleteProperty(g.value,t)}async function pe(){var l;const{data:t}=await De(),e=(l=t.list)==null?void 0:l.map(s=>({value:s.file_name,label:s.language_name}));w.value.forEach((s,d)=>{s.valueName==="lang_code"&&(w.value[d].defaultOption=e,D.value[d].defaultOption=e)})}return pe(),u(),w.value=O(P.value),D.value=O(P.value),(t,e)=>{const l=ye,s=ge,d=Ie,A=Ce,H=Ee,G=ve,fe=he("resize");return _e(),xe("div",null,[r(A,{title:"客服列表"},{"header-extra":h(()=>[r(l,{"export-all-loading":m(i),"onUpdate:exportAllLoading":e[0]||(e[0]=a=>I(i)?i.value=a:null),"refresh-button-loading":v.value,"onUpdate:refreshButtonLoading":e[1]||(e[1]=a=>v.value=a),"export-selected-disabled":f.value.length,"onUpdate:exportSelectedDisabled":e[2]||(e[2]=a=>f.value.length=a),"batch-delete-disabled":f.value.length,"onUpdate:batchDeleteDisabled":e[3]||(e[3]=a=>f.value.length=a),"export-filter-loading":m(i),"onUpdate:exportFilterLoading":e[4]||(e[4]=a=>I(i)?i.value=a:null),"export-selected-loading":m(i),"onUpdate:exportSelectedLoading":e[5]||(e[5]=a=>I(i)?i.value=a:null),onExportAll:oe,onExportFilter:e[6]||(e[6]=a=>m(F)({tableColumns:U,tableData:E(N.value),fileName:R})),onExportSelected:e[7]||(e[7]=a=>m(F)({tableColumns:U,tableData:E(T.value),fileName:R})),onAdd:re,onBatchDelete:ie,onRefresh:u},null,8,["export-all-loading","refresh-button-loading","export-selected-disabled","batch-delete-disabled","export-filter-loading","export-selected-loading"])]),default:h(()=>[r(s,{"search-config":Y.value,onOnSearch:ne},null,8,["search-config"]),Se(r(d,{remote:"",columns:U,data:N.value,loading:v.value,bordered:!1,style:{height:"620px"},"flex-height":"","scroll-x":1e3,pagination:m(p),"row-key":a=>a.id,"checked-row-keys":f.value,"render-cell":m(X),"onUpdate:checkedRowKeys":se,"onUpdate:page":me,"onUpdate:pageSize":ce},null,8,["data","loading","pagination","row-key","checked-row-keys","render-cell"]),[[fe]])]),_:1}),r(G,{"show-form-modal":S.value,"onUpdate:showFormModal":e[10]||(e[10]=a=>S.value=a),"is-async-shut-down":V.value,"onUpdate:isAsyncShutDown":e[11]||(e[11]=a=>V.value=a),"is-show-modal-loading":y.value,"onUpdate:isShowModalLoading":e[12]||(e[12]=a=>y.value=a),"modal-title":m(c)("common.add"),"modal-form-config":w.value,"form-rules":B,onOnSubmit:ue},{slotImg:h(()=>[r(H,{"file-list":z.value,"onUpdate:fileList":e[8]||(e[8]=a=>z.value=a),"list-type":"image-card",max:1,"custom-request":j,onRemove:e[9]||(e[9]=a=>K("image"))},{default:h(()=>e[18]||(e[18]=[Q(" 点击上传 ")])),_:1},8,["file-list"])]),_:1},8,["show-form-modal","is-async-shut-down","is-show-modal-loading","modal-title","modal-form-config"]),r(G,{"show-form-modal":k.value,"onUpdate:showFormModal":e[15]||(e[15]=a=>k.value=a),"is-async-shut-down":q.value,"onUpdate:isAsyncShutDown":e[16]||(e[16]=a=>q.value=a),"is-show-modal-loading":b.value,"onUpdate:isShowModalLoading":e[17]||(e[17]=a=>b.value=a),"modal-title":m(c)("common.modify"),"modal-form-config":D.value,"form-rules":B,onOnSubmit:de},{slotImg:h(()=>[r(H,{"file-list":L.value,"onUpdate:fileList":e[13]||(e[13]=a=>L.value=a),"list-type":"image-card",max:1,"custom-request":j,onRemove:e[14]||(e[14]=a=>K("image"))},{default:h(()=>e[19]||(e[19]=[Q(" 点击上传 ")])),_:1},8,["file-list"])]),_:1},8,["show-form-modal","is-async-shut-down","is-show-modal-loading","modal-title","modal-form-config"])])}}});export{rt as default};
