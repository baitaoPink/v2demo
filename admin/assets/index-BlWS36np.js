import{_ as Me}from"./modal-form.vue_vue_type_script_setup_true_lang-CK4e59aF.js";import{_ as De}from"./search-header-DtgPJj_M.js";import{_ as Se}from"./table-header-button-group.vue_vue_type_script_setup_true_lang-CkvY7H9b.js";import{d as ke,O as Ne,r as l,V as Ce,o as Ae,b as Ye,f as o,w as v,h as w,B as m,g as c,W as y,a2 as p,a8 as Ee,Y as h,aa as Fe,N as Oe}from"./index-BJhWTHLH.js";import{g as Ie}from"./mentor-management-CnuY7LL-.js";import{g as Ue,f as Be,a as xe,b as ze,c as He,d as Le,e as K}from"./review-CRLm-2hq.js";import{u as Te}from"./custom-table-_CHhGcPh.js";import{_ as B}from"./Flex-BpbQ-piH.js";import{_ as je}from"./DataTable-DTnHU6yB.js";import{_ as qe}from"./Spin-DCotS9Cy.js";import"./multi-language-form.vue_vue_type_script_setup_true_lang-6wOzkJUB.js";import"./custom-upload-pm3HiWtn.js";import"./Grid-fLrdiz9h.js";import"./get-slot-Bk_rJcZu.js";import"./FormItem-CZtIF2i1.js";import"./DatePicker-Cx_UomHY.js";import"./TimePicker-I8wAfOf0.js";import"./Forward-CJ8y3GqN.js";import"./RadioGroup-S93Synw1.js";import"./Space-BcqaYfMg.js";const dt=ke({name:"documentation-management_position-order",__name:"index",setup(Re){const{pagination:u,renderCell:G}=Te(),f=Ne(),b=l({user_type:"1"}),O=l([{type:"Input",valueName:"account_key",label:"用户账号"},{type:"Input",valueName:"order_no",label:"订单号"},{type:"Select",valueName:"trader_id",label:"操盘师",selectFilter:!0},{type:"Select",valueName:"user_type",label:"用户类型",defaultOption:[{label:"正式用户",value:1},{label:"试玩用户",value:2}]},{type:"Select",valueName:"order_status",label:"状态",defaultOption:[{label:"全部",value:0},{label:"进行中",value:2},{label:"持仓中",value:4},{label:"已结束",value:5}]},{type:"Datetime",datetimeType:"datetimerange",valueName:"create_time",label:"创建时间"}]),g=l(!1),x=l([]),z=l(),r=l(),s=l([]),d=l([]),I=l(!1),H=l(!0),M=l(!1),D=l(!1),L=l(!0),S=l(!1),k=l(!1),N=l(!1),T=l(!0),C=l(!1),A=l(!1),j=l(!0),Y=l(!1),E=l(!1),q=l(!0),F=l(!1),J=l([{type:"Input Number",valueName:"contract",label:"续期天数"}]),Q=l([{type:"Input",inputType:"textarea",valueName:"order_no",label:"订单ID",placeholder:"请输入订单号，每个订单号以，号隔开"},{type:"Input Number",valueName:"contract",label:"续期天数"}]),W={contract:[{required:!0,trigger:["blur"],validator:(e,t)=>{const n=/^[1-9]\d*$/;return t?n.test(t)?!0:new Error("请输入正整数"):new Error("请输入续期天数")}}]},X={contract:[{required:!0,trigger:["blur"],validator:(e,t)=>{const n=/^[1-9]\d*$/;return t?n.test(t)?!0:new Error("请输入正整数"):new Error("请输入续期天数")}}],order_no:[{required:!0,message:"请输入订单号",trigger:["blur"]}]},Z=l([{type:"Input Number",valueName:"money",label:"组件金额"}]),ee={money:[{required:!0,trigger:["blur"],validator:(e,t)=>t?t<=0?new Error("请输入金额需大于0"):!0:new Error("请输入金额")}]},R=l([{type:"Datetime",datetimeType:"date",valueName:"end_time",label:"结束日期"}]),te={end_time:[{required:!0,type:"date",message:"请选择结束日期",trigger:["blur"]}]},$=l([{type:"Input",valueName:"order_no",label:"订单号",disabled:!0},{type:"Input",valueName:"money",label:"初始金额",disabled:!0},{type:"Input",valueName:"contract",label:"合约天数",disabled:!0},{type:"Input",valueName:"cycle_day",label:"跟单周期",disabled:!0},{type:"Datetime",datetimeType:"datetime",valueName:"settlement_time",label:"订单结束结算时间",disabled:!0},{type:"Input",valueName:"settlement_day",label:"交易结算天数",disabled:!0},{type:"Datetime",datetimeType:"datetime",valueName:"settlement_last_time",label:"上一次结算时间",disabled:!0},{type:"Input",valueName:"add_contract",label:"累计续期天数",disabled:!0},{type:"Input",valueName:"add_money",label:"累计追加金额",disabled:!0},{type:"Input",valueName:"settlement_amount",label:"结算金额",disabled:!0},{type:"Select",valueName:"order_type_str",label:"订单类型",disabled:!0,defaultOption:[{label:"单日跟单",value:1},{label:"多日日跟单",value:2}]},{type:"Select",valueName:"is_sell",label:"是否卖出",disabled:!0,defaultOption:[{value:0,label:"否"},{value:1,label:"是"}]},{type:"Datetime",datetimeType:"datetime",valueName:"start_time",label:"确认时间",disabled:!1,tip:"会影响下单，如果低于14点后当日订单就无法下单操盘了"},{type:"Input",valueName:"commission_ratio",label:"导师手续费",disabled:!1,tip:"每次导师操盘的手续费"},{type:"Input",valueName:"money_available",label:"当前可用金额",disabled:!1,tip:"购买金额-减去盈亏情况等于可用的"}]),ae={end_time:[{required:!0,message:"请选择确认时间",trigger:["blur"]}],ti:[{required:!0,type:"float",message:"请输入导师手续费",trigger:["blur"]}],ti1:[{required:!0,type:"float",message:"请输入订单盈亏情况",trigger:["blur"]}]};async function i(){var t,n;g.value=!0;const{data:e}=await Ue({...b.value,create_time:Array.isArray((t=b.value)==null?void 0:t.create_time)?(n=b.value)==null?void 0:n.create_time.map(U=>p(U).format("YYYY/MM/DD")).join("-"):void 0,page:u.page,limit:u.pageSize});u.itemCount=e.count,x.value=e.list,g.value=!1}const V=[{type:"selection"},{title:"ID",key:"id",align:"center",width:"100"},{title:"账号/姓名",key:"account",align:"center",width:"120",render:e=>o(B,{justify:"center"},{default:()=>[o("p",null,[e.account_name||""]),o("p",null,[e.account||""])]})},{title:"订单号",key:"order_no",align:"center",width:"280",render:e=>e.order_no||""},{title:"正式用户",key:"user_type",align:"center",width:"100",render:e=>o(Ee,{type:e.user_type===1?"success":"error"},{default:()=>[e.user_type===1?"是":"否"]})},{title:"佣金比",key:"commission_ratio",align:"center",width:"100"},{title:"操盘师",key:"trader_name",align:"center",width:"100"},{title:"申请时间",key:"create_time",align:"center",width:"180",render:e=>e.create_time?p(e.create_time).format("YYYY-MM-DD HH:mm:ss"):""},{title:"确认时间",key:"start_time",align:"center",width:"180",render:e=>e.audit_time?p(e.audit_time).format("YYYY-MM-DD HH:mm:ss"):""},{title:"结束时间",key:"end_time",align:"center",width:"180",render:e=>e.end_time?p(e.end_time).format("YYYY-MM-DD HH:mm:ss"):""},{title:"市场",key:"market_type_name",align:"center",width:"80"},{title:"币种",key:"money_type_name",align:"center",width:"80"},{title:"初始金额",key:"money",align:"center",width:"120"},{title:"追加金额",key:"add_money",align:"center",width:"120"},{title:"可用余额",key:"money_available",align:"center",width:"120"},{title:"合约天数",key:"contract",align:"center",width:"120"},{title:"持有收益",key:"profit",align:"center",width:"120"},{title:"收益率",key:"profit_ratio",align:"center",width:"120"},{title:"上次结算时间",key:"settlement_last_time",align:"center",width:"180",render:e=>e.settlement_last_time?p(e.settlement_last_time).format("YYYY-MM-DD HH:mm:ss"):""},{title:"结算时间",key:"settlement_time",align:"center",width:"180",render:e=>e.settlement_time?p(e.settlement_time).format("YYYY-MM-DD HH:mm:ss"):""},{title:"结算收益",key:"settlement_amount",align:"center",width:"120"},{title:"状态",key:"order_status_str",align:"center",width:"100"},{title:"累计补偿亏损",key:"sum_compensate_money",align:"center",width:"100"},{title:"累计补贴收益",key:"sum_subsidy_money",align:"center",width:"100"},{title:"操作",key:"action",align:"center",width:200,fixed:"right",render:e=>o(B,{justify:"center"},{default:()=>[o(m,{type:"success",size:"small",onClick:()=>{ie(e.id)}},{default:()=>[c("收益明细")]}),y(o(m,{type:"warning",size:"small",onClick:()=>{r.value=e.id,P(e.id)}},{default:()=>[c("结算订单")]}),[[h,e.order_status!==5]]),y(o(m,{type:"primary",size:"small",onClick:()=>{r.value=e.id,M.value=!0}},{default:()=>[c("合约续期")]}),[[h,e.order_status!==5]]),y(o(m,{type:"primary",size:"small",onClick:()=>{r.value=e.id,N.value=!0}},{default:()=>[c("追加投资")]}),[[h,e.order_status!==5]]),y(o(m,{type:"primary",size:"small",onClick:ve.bind(null,e)},{default:()=>[c("修改日期")]}),[[h,e.order_status!==5]]),y(o(m,{type:"primary",size:"small",onClick:fe.bind(null,e)},{default:()=>[c("编辑订单")]}),[[h,e.order_status!==5]])]})}];function le(e,t){s.value=e,d.value=t}function oe(e){u.page=e,i()}function ne(e){u.page=1,u.pageSize=e,i()}function re(e){b.value=e,u.page=1,i()}async function se(){const{data:e}=await Ie();z.value=e.map(t=>({label:t.name,value:t.value})),O.value.forEach((t,n)=>{t.valueName==="trader_id"&&(O.value[n].defaultOption=z.value)})}async function P(e){I.value=!0;const{response:t}=e||e===0?await Be({id:e}):await xe({ids:s.value.join(",")});t.data.status===200&&(r.value=void 0,s.value=[],d.value=[],i(),f.success("结算成功")),I.value=!1}function ie(e){Fe.push({path:"/documentation-management/order-record",query:{order_id:e==null?void 0:e.toString()}})}async function ue(e){const t={};e.up_where&&(t.up_where=e.up_where.join(",")),D.value=!0;const{response:n}=await ze({...e,...t,id:`${r.value}`});n.data.status===200&&(s.value=[],d.value=[],i(),f.success("提交成功"),M.value=!1),D.value=!1}async function de(e){const t={};e.up_where&&(t.up_where=e.up_where.join(",")),k.value=!0;const{response:n}=await He({...e,...t,ids:s.value.join(",")});n.data.status===200&&(s.value=[],d.value=[],i(),f.success("提交成功"),S.value=!1),k.value=!1}async function me(e){const t={};e.up_where&&(t.up_where=e.up_where.join(",")),C.value=!0;const{response:n}=await Le({...e,...t,id:`${r.value}`,money:`${e.money}`});n.data.status===200&&(s.value=[],d.value=[],i(),f.success("提交成功"),N.value=!1),C.value=!1}async function ce(e){const t={};e.up_where&&(t.up_where=e.up_where.join(",")),Y.value=!0;const{response:n}=await K(r.value,{end_time:p(e.end_time).format("YYYY-MM-DD"),...t,id:`${r.value}`});n.data.status===200&&(s.value=[],d.value=[],i(),f.success("提交成功"),A.value=!1),Y.value=!1}async function pe(e){e.up_where&&e.up_where.join(","),F.value=!0;const{response:t}=await K(r.value,{commission_ratio:e.commission_ratio,money_available:e.money_available,start_time:p(e.start_time).format("YYYY-MM-DD HH:mm:ss"),id:`${r.value}`});t.data.status===200&&(s.value=[],d.value=[],i(),f.success("提交成功"),E.value=!1),F.value=!1}function fe(e){r.value=e.id,$.value.forEach(t=>{t.valueName==="commission_ratio"?t.defaultValue=e[t.valueName].replace("%",""):t.defaultValue=e[t.valueName]||void 0}),E.value=!0}function ve(e){r.value=e.id,R.value.forEach(t=>{t.defaultValue=e[t.valueName]||void 0}),A.value=!0}se(),i();const ye=l(V.reduce((e,t)=>Number(e)+Number(t.width),0));return(e,t)=>{const n=B,U=Se,ge=De,_e=je,we=Oe,_=Me,he=qe,be=Ce("resize");return Ae(),Ye("div",null,[o(he,{show:I.value},{default:v(()=>[o(we,{title:"持仓订单列表"},{"header-extra":v(()=>[o(U,{"refresh-button-loading":g.value,"onUpdate:refreshButtonLoading":t[2]||(t[2]=a=>g.value=a),"is-add":!1,"is-batch-delete":!1,"is-export-all":!1,"is-export-filter":!1,"is-export-selected":!1,"slot-name":"bars",onRefresh:i},{bars:v(()=>[o(n,{justify:"center"},{default:v(()=>[o(w(m),{size:"small",ghost:"",type:"success",disabled:!s.value.length,onClick:t[0]||(t[0]=()=>{d.value.some(a=>a.order_status===5)?w(f).error("只可结算未结速状态的数据"):P()})},{default:v(()=>t[18]||(t[18]=[c(" 批量结算 ")])),_:1},8,["disabled"]),o(w(m),{size:"small",ghost:"",type:"success",disabled:!s.value.length,onClick:t[1]||(t[1]=()=>{S.value=!0})},{default:v(()=>t[19]||(t[19]=[c(" 批量合约续期 ")])),_:1},8,["disabled"])]),_:1})]),_:1},8,["refresh-button-loading"])]),default:v(()=>[o(ge,{"search-config":O.value,onOnSearch:re},null,8,["search-config"]),y(o(_e,{remote:"",columns:V,data:x.value,loading:g.value,bordered:!1,style:{height:"560px"},"flex-height":"","scroll-x":ye.value,pagination:w(u),"row-key":a=>a.id,"render-cell":w(G),"checked-row-keys":s.value,"onUpdate:checkedRowKeys":le,"onUpdate:page":oe,"onUpdate:pageSize":ne},null,8,["data","loading","scroll-x","pagination","row-key","render-cell","checked-row-keys"]),[[be]])]),_:1}),o(_,{"show-form-modal":M.value,"onUpdate:showFormModal":t[3]||(t[3]=a=>M.value=a),"is-async-shut-down":H.value,"onUpdate:isAsyncShutDown":t[4]||(t[4]=a=>H.value=a),"is-show-modal-loading":D.value,"onUpdate:isShowModalLoading":t[5]||(t[5]=a=>D.value=a),"modal-title":"合约续期","modal-form-config":J.value,"form-rules":W,onOnSubmit:ue},null,8,["show-form-modal","is-async-shut-down","is-show-modal-loading","modal-form-config"]),o(_,{"show-form-modal":S.value,"onUpdate:showFormModal":t[6]||(t[6]=a=>S.value=a),"is-async-shut-down":L.value,"onUpdate:isAsyncShutDown":t[7]||(t[7]=a=>L.value=a),"is-show-modal-loading":k.value,"onUpdate:isShowModalLoading":t[8]||(t[8]=a=>k.value=a),"modal-title":"批量合约续期","modal-form-config":Q.value,"form-rules":X,onOnSubmit:de},null,8,["show-form-modal","is-async-shut-down","is-show-modal-loading","modal-form-config"]),o(_,{"show-form-modal":N.value,"onUpdate:showFormModal":t[9]||(t[9]=a=>N.value=a),"is-async-shut-down":T.value,"onUpdate:isAsyncShutDown":t[10]||(t[10]=a=>T.value=a),"is-show-modal-loading":C.value,"onUpdate:isShowModalLoading":t[11]||(t[11]=a=>C.value=a),"modal-title":"追加金额","modal-form-config":Z.value,"form-rules":ee,onOnSubmit:me},null,8,["show-form-modal","is-async-shut-down","is-show-modal-loading","modal-form-config"]),o(_,{"show-form-modal":A.value,"onUpdate:showFormModal":t[12]||(t[12]=a=>A.value=a),"is-async-shut-down":j.value,"onUpdate:isAsyncShutDown":t[13]||(t[13]=a=>j.value=a),"is-show-modal-loading":Y.value,"onUpdate:isShowModalLoading":t[14]||(t[14]=a=>Y.value=a),"modal-title":"修改日期","modal-form-config":R.value,"form-rules":te,onOnSubmit:ce},null,8,["show-form-modal","is-async-shut-down","is-show-modal-loading","modal-form-config"]),o(_,{"show-form-modal":E.value,"onUpdate:showFormModal":t[15]||(t[15]=a=>E.value=a),"is-async-shut-down":q.value,"onUpdate:isAsyncShutDown":t[16]||(t[16]=a=>q.value=a),"is-show-modal-loading":F.value,"onUpdate:isShowModalLoading":t[17]||(t[17]=a=>F.value=a),"modal-title":"修改","modal-form-config":$.value,"form-rules":ae,onOnSubmit:pe},null,8,["show-form-modal","is-async-shut-down","is-show-modal-loading","modal-form-config"])]),_:1},8,["show"])])}}});export{dt as default};
